name: Deploy Release to Vercel (static)

on:
  release:
    types: [published]

jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
      VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
      VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

    steps:
      # 릴리즈 자산 ZIP 다운로드 (태그명 기준)
      - name: Download release asset
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          TAG="${{ github.event.release.tag_name }}"
          # 릴리즈 자산 이름 패턴에 맞춰 조정하세요 (예: build-v1.2.3.zip)
          gh release download "$TAG" --pattern "build-$TAG.zip" --dir .
          ls -al

      - name: Unzip build
        run: |
          TAG="${{ github.event.release.tag_name }}"
          unzip -o "build-$TAG.zip" -d extracted
          test -d extracted/dist || (echo "dist/ not found" && exit 1)
          ls -al extracted/dist

      - name: Install Vercel CLI
        run: npm i -g vercel@latest

      - name: Deploy to Vercel (static directory)
        run: |
          vercel deploy extracted/dist \
            --prod \
            --yes --confirm \
            --archive=tgz \
            --token "$VERCEL_TOKEN" \
            --org "$VERCEL_ORG_ID" \
            --project "$VERCEL_PROJECT_ID"
